<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>D3 Test</title>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.6/d3.min.js" charset="utf-8"></script>
        <style type="text/css">
    
        .dorm{
          fill: LimeGreen;
        }
        .academicBuilding{
          fill: LightCoral;
        }
        .activities{
          fill: MidnightBlue;
        }
    
    </style>
     
        <div class="campus">
        <svg width="1200" height="650">

          <g class="dorm">
            <!-- Plant -->
           <rect id="Plant" num="0" x="590" y="250" width="80" height="45"/>
           <!--Branford -->
           <rect id="Branford" num="1" x="685" y="250" width="80" height="45"/>
           <!--Smith-->
           <rect id="Smith" num="2" x="800" y="250" width="40" height="75"/>
           <!--Burdick-->
           <rect id="Burdick" num="3" x="780" y="320" width="80" height="40"/>
           <!--BlackStone -->
           <rect id="Blackstone" num="4" x="590" y="320" width ="80" height="45"/>
           <!--KB-->
            <rect id="KB" num="5" x="950" y="250" width="80" height="45"/>
           <!-- Larabee -->
           <rect id="Larabee" num="6" x="925" y="285" width="70" height="85"/>
           <!--Windham-->
           <rect id="Windham" num="7" x="580" y="75" width="80" height="50"/>
           <!--Lazarus-->
           <rect id="Lazarus" num="8" x="800" y="5" width="90" height="50"/> 
           <!--PLEX-->
           <rect id="Plex" num="9" x="1085" y="125" width="125" height="125"/>
           <!--JA-->
           <rect id="JA" num="10" x="100" y="70" width="90" height="45" />
           <!--FreeMan-->
           <rect id="Freeman" num="11" x="70" y="115" width="60" height="70" />
           <!--Harkness-->
           <rect id="Harkness" num="12" x="240" y="70" width="90" height="60" />
           <!--Knowlton-->
           <rect id="Knowlton" num="13" x="390" y="75" width="110" height="55" />
          </g>

          <g class="academicBuilding">
            <!--Hale-->
            <rect id="Hale" num="14" x="590" y="390" width="80" height="45"/>
            <!--Tansil-->
            <rect id="Tansil" num="15" x="725" y="390" width="90" height="55"/>
            <!--Library-->
            <rect id="library" num="16" x="665" y="145" width="135" height="75"/>
            <!--Blaustein-->
            <rect id="Blaustein" num="17" x="590" y="145" width="60" height="85"/>
            <!--Cummings-->
            <rect id="Cummings" num="18" x="50" y="260" width="110" height="90"/>
            <!--Palmer-->
            <rect id="Palmer" num="19" x="190" y="250" width="70" height="100"/>
            <!--Bill Hall-->
            <rect id="Bill" num="20" x="285" y="250" width="60" height="100"/>
            <!--Fanning-->
            <rect id="Fanning" num="21" x="363" y="310" width="87" height="50"/>
            <!--New London-->
            <rect id="NewLondon" num="22" x="467" y="250" width="75" height="115" />
            <!--Olin-->
            <rect id="Olin" num="23" x="475" y="390" width="65" height="50" />
          </g>

          <g class="activities">
            <!--Harkness Chapel-->
            <rect id="Chapel" num="24" x="600" y="10" width="50" height="35"/>
            <!--Cro-->
            <rect id="Cro" num="25" x="850" y="160" width="150" height="70"/>
            <!--Health Center-->
            <rect id="Health" num="26" x="700" y="75" width="80" height="50"/>
            <!--Field House-->
            <rect id="Field" num="27" x="700" y="470" width="100" height="70"/>
            <!--Dayton Arena-->
            <rect id="Arena" num="28" x="860" y="470" width="110" height="50"/>
            <!--Gym-->
            <rect id="Gym" num="29" x="800" y="525" width="50" height="55"/>
            <!--Natatorium-->
            <rect id="Natatorium" num="30" x="850" y="540" width="80" height="50"/>
            <!--Track-->
            <ellipse id="Track" num="31" cx="750" cy="613" rx="70" ry="35" />
          </g>
      </svg>

    </head>
    <body>
    <script type="text/javascript" src="student.js"></script>   
    <script type="text/javascript" src="buildingNode.js"></script>
    <script type="text/javascript" src="buildingHashList.js"></script>  
      <script type="text/javascript">
      var buildingList= new BuildingHashList();
      buildingList.addElement(new buildingNode("ja",1,2));

      function findMiddle(d3obj) {

          var ret = Object();

          if (d3obj[0][0].localName == "ellipse" || d3obj[0][0].localName == "circle") {
            ret.x = parseInt(d3obj.attr("cx"));
            ret.y = parseInt(d3obj.attr("cy"));

          } else {
            ret.x = parseInt(d3obj.attr("x")) + parseInt(d3obj.attr("width")) / 2;
            ret.y = parseInt(d3obj.attr("y")) + parseInt(d3obj.attr("height")) / 2;
          }

          return ret;
      }

      var svg = d3.select('svg');
    
      var allBuilding = d3.selectAll("rect, ellipse")[0];
      console.log(allBuilding);
      
      var svg = d3.select("svg");

      for (var i = 0; i < allBuilding.length; ++i) {

        var building = d3.select(allBuilding[i]);
        

        var buildingName = svg.append("text")
          .attr("text-anchor", "middle")
          .attr("fill", "white")
          .text(function(){
            return (building.attr("id"));
          });

        var buildingNum = svg.append("text")
          .attr("text-anchor", "middle")
          .attr("fill", "white")
          .text(function(){
            return (building.attr("num"));
          });

        var middle = findMiddle(building);

        buildingNum.attr("x", middle.x)
                  .attr("y", middle.y + 15);

        if (allBuilding[i].localName == "rect") {

          var midX = parseInt(building.attr("x")) + parseInt(building.attr("width")) / 2;
          var midY = parseInt(building.attr("y")) + parseInt(building.attr("height")) / 2;
    		  buildingList.addElement(new buildingNode(building.attr("id"),midX,midY));
          buildingName.attr("x", midX)
                      .attr("y", midY);
        } 
        else {
          buildingList.addElement(new buildingNode(building.attr("id"),building.attr("cx"),building.attr("cy")));
          buildingName.attr("x", building.attr("cx"))
                      .attr("y", building.attr("cy"));
        }      
      }


      //each node represents a point of intersection
      var nodes = [
            [0, [40, 65]], [1, [150, 65]], [2, [285, 65]], [3, [445, 65]], [4, [570, 65]], [5, [625, 65]], [6, [850, 65]], [7, [1075, 65]], // horizontal road 0
            [8, [150, 135]], [9, [285, 135]], [10, [445, 135]], [11, [570, 135]], [12, [625, 135]], [13, [740, 135]], [14, [920, 135]], [15, [1075, 135]], // horizontal road 1
            [16, [40, 240]], [17, [90, 240]], [18, [225, 240]], [19, [315, 240]], [20, [405, 240]], [21, [505, 240]], [22, [570, 240]], [23, [625, 240]], [24, [725, 240]], [25, [820, 240]], [26, [920, 240]], [27, [1075, 240]], // horizontal road 2
            [28, [40, 380]], [29, [90, 380]], [30, [225, 380]], [31, [315, 380]], [32, [405, 380]], [33, [505, 380]], [34, [570, 380]], [35, [625, 380]], [36, [770, 380]], [37, [820, 380]], [38, [960, 380]], [39, [1075, 380]], // horizontal road 3
            [40, [830, 490]] // lone node
          ]

        //print out points of intersection
        for (var i =0; i < nodes.length; i++){
          svg.append("text")
            .text(i)
            .attr("x", nodes[i][1][0])
            .attr("y", nodes[i][1][1]);
        }
        
        var z = Infinity;

        //adjacency matrix defining the graph
        //1 means two nodes are connected, z means inconnected
        var adj_map = [
        // 0  1  2  3  4  5  6  7  8  9  10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40
          [z, 1, z, z, z, z, z, z, z, z, z, z, z, z, z, z, 1, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z ], // 0
          [1, z, 1, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z ], // 1
          [z, 1, z, 1, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z ], // 2
          [z, z, 1, z, 1, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z ], // 3
          [z, z, z, 1, z, 1, z, z, z, z, z, 1, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z ], // 4
          [z, z, z, z, 1, z, 1, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z ], // 5
          [z, z, z, z, z, 1, z, 1, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z ], // 6
          [z, z, z, z, z, z, 1, z, z, z, z, z, z, z, z, 1, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z ], // 7
          [z, z, z, z, z, z, z, z, z, 1, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z ], // 8
          [z, z, z, z, z, z, z, z, 1, z, 1, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z ], // 9
          [z, z, z, z, z, z, z, z, z, 1, z, 1, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z ], // 10
          [z, z, z, z, 1, z, z, z, z, z, 1, z, 1, z, z, z, z, z, z, z, z, z, 1, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z ], // 11
          [z, z, z, z, z, z, z, z, z, z, z, 1, z, 1, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z ], // 12
          [z, z, z, z, z, z, z, z, z, z, z, z, 1, z, 1, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z ], // 13
          [z, z, z, z, z, z, z, z, z, z, z, z, z, 1, z, 1, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z ], // 14
          [z, z, z, z, z, z, z, 1, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, 1, z, z, z, z, z, z, z, z, z, z, z, z, z ], // 15
          [1, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, 1, z, z, z, z, z, z, z, z, z, z, 1, z, z, z, z, z, z, z, z, z, z, z, z ], // 16
          [z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, 1, z, 1, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z ], // 17
          [z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, 1, z, 1, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z ], // 18
          [z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, 1, z, 1, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z ], // 19
          [z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, 1, z, 1, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z ], // 20
          [z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, 1, z, 1, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z ], // 21
          [z, z, z, z, z, z, z, z, z, z, z, 1, z, z, z, z, z, z, z, z, z, 1, z, 1, z, z, z, z, z, z, z, z, z, z, 1, z, z, z, z, z, z ], // 22
          [z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, 1, z, 1, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z ], // 23
          [z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, 1, z, 1, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z ], // 24
          [z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, 1, z, 1, z, z, z, z, z, z, z, z, z, z, z, z, z, z ], // 25
          [z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, 1, z, 1, z, z, z, z, z, z, z, z, z, z, z, z, z ], // 26
          [z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, 1, z, z, z, z, z, z, z, z, z, z, 1, z, z, z, z, z, z, z, z, z, z, z, z, 1, z ], // 27
          [z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, 1, z, z, z, z, z, z, z, z, z, z, z, z, 1, z, z, z, z, z, z, z, z, z, z, z ], // 28
          [z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, 1, z, 1, z, z, z, z, z, z, z, z, z, z ], // 29
          [z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, 1, z, 1, z, z, z, z, z, z, z, z, z ], // 30
          [z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, 1, z, 1, z, z, z, z, z, z, z, z ], // 31
          [z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, 1, z, 1, z, z, z, z, z, z, z ], // 32
          [z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, 1, z, 1, z, z, z, z, z, z ], // 33
          [z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, 1, z, z, z, z, z, z, z, z, z, z, 1, z, 1, z, z, z, z, z ], // 34
          [z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, 1, z, 1, z, z, z, z ], // 35
          [z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, 1, z, 1, z, z, z ], // 36
          [z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, 1, z, 1, z, z ], // 37
          [z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, 1, z, 1, 1 ], // 38
          [z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, 1, z, z, z, z, z, z, z, z, z, z, 1, z, z ], // 39
          [z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, z, 1, z, z ], // 40
        ]

        //go over the matrix and check the relation between nodes
        for (var i=0; i < adj_map.length; i++){
          for (var s=i+1; s < adj_map[i].length; s++){
            if (adj_map[i][s] == 1){
              var x1 = nodes[i][1][0];
              var y1 = nodes[i][1][1];
              var x2 = nodes[s][1][0];
              var y2 = nodes[s][1][1];

              //draw the path
              svg.append("line")
                .attr("x1", x1)
                .attr("y1", y1)
                .attr("x2", x2)
                .attr("y2", y2)
                .style("stroke","black");

              //calculate the distance between two nodes
              var dx = x2-x1;
              var dy = y2-y1;
              adj_map[i][s] = adj_map[s][i] = Math.sqrt(dx * dx + dy * dy);
            }
          }
        }

      console.log(adj_map);
      
      console.log("HELOO");
      console.log(buildingList.returnElementBy("Gym"));
      var classes=["Gym","JA","Freeman","Windham","Plex","Health","Cro","Blaustein","Chapel"];
      var stu1=new Student(classes, "harkness", "yes", "JA");
      //stu1.addNewItinerary("five");
      console.log(stu1.getFullItinerary());


      var last_location = 0;
      var dest_location = last_location;
      var orig_location = last_location;

      var orig_nodes = nodes[last_location][1];
      var dest_nodes = nodes[dest_location][1];

      var svg = d3.select('svg');
      var myCircle = svg.append('circle')
            .attr('cx', orig_nodes[0])
            .attr('cy', orig_nodes[1])
            .attr('r', 10)
            .attr('fill',"yellow");

      function move_random() {  

        var possible = [];

        for (var i = 0; i < adj_map[last_location].length; i++){
          if (adj_map[last_location][i] != Infinity) {
            if (i != orig_location) {
              possible.push(i);
            }
          }
        }

        if (possible.length == 0){
          possible.push(orig_location);
        }

        dest_location = possible[Math.floor(Math.random()*possible.length)]
        dest_nodes = nodes[dest_location][1];

        myCircle
          .transition()
          .ease("linear")
          .attr("cx", dest_nodes[0])
          .attr("cy", dest_nodes[1])
          .duration(adj_map[last_location][dest_location] * 8)
          .each("end", move_random);

        orig_location = last_location;
        last_location = dest_location;
      };

      setTimeout(move_random, 1000);


      </script>

    </body>
</html>